{% if is_paginated %}
<nav aria-label="Page navigation" class="mt-3">
    <ul class="pagination justify-content-center">

        {# ← Предыдущая страница #}
        {% if page_obj.has_previous %}
        <li class="page-item">
            <a class="page-link" href="?q={{ q }}&page={{ page_obj.previous_page_number }}">←</a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <span class="page-link">←</span>
        </li>
        {% endif %}

        {% with total=page_obj.paginator.num_pages current=page_obj.number %}

            {# Первая страница #}
            <li class="page-item {% if current == 1 %}active{% endif %}">
                <a class="page-link" href="?q={{ q }}&page=1">1</a>
            </li>

            {# Многоточие слева #}
            {% if current > 4 %}
                <li class="page-item disabled"><span class="page-link">...</span></li>
            {% endif %}

            {# Средние страницы (текущая ±2) #}
            {% for i in page_obj.paginator.page_range %}
                {% if i > 1 and i < total and i >= current|add:-2 and i <= current|add:2 %}
                <li class="page-item {% if i == current %}active{% endif %}">
                    <a class="page-link" href="?q={{ q }}&page={{ i }}">{{ i }}</a>
                </li>
                {% endif %}
            {% endfor %}

            {# Многоточие справа #}
            {% if current < total|add:-3 %}
                <li class="page-item disabled"><span class="page-link">...</span></li>
            {% endif %}

            {# Последняя страница #}
            <li class="page-item {% if current == total %}active{% endif %}">
                <a class="page-link" href="?q={{ q }}&page={{ total }}">{{ total }}</a>
            </li>

        {% endwith %}

        {# → Следующая страница #}
        {% if page_obj.has_next %}
        <li class="page-item">
            <a class="page-link" href="?q={{ q }}&page={{ page_obj.next_page_number }}">→</a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <span class="page-link">→</span>
        </li>
        {% endif %}

    </ul>
</nav>
{% endif %}
